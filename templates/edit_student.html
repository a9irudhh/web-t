<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System - Edit Student</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="{{ url_for('static', filename='js/edit_student.js') }}" defer></script>
    <script>
        function confirmSave() {
            return confirm('Are you sure you want to save these changes?');
        }
    </script>
</head>
<body>
    <div class="edit-student-container">
        <h1 class="edit-student-title">Edit Student Details</h1>
        <form action="{{ url_for('edit_student', id=student._id) }}" method="POST" class="edit-student-form" onsubmit="return confirmSave();">
            <input type="hidden" name="srn" value="{{ student.srn }}">

            <label for="name">Name</label>
            <input type="text" id="name" name="name" value="{{ student.name }}" {% if not is_admin %}readonly{% endif %} required>

            <label for="age">Age</label>
            <input type="number" id="age" name="age" value="{{ student.age }}" {% if not is_admin %}readonly{% endif %} required>

            <label for="phone_number">Phone Number</label>
            <input type="text" id="phone_number" name="phone_number" value="{{ student.phone_number }}" {% if not is_admin %}readonly{% endif %} required>

            <div id="semesters">
                {% for sem in student.semesters %}
                <div class="edit-student-semester" id="semester-{{ loop.index }}">
                    <h2 class="edit-student-semester-title">Semester {{ sem.semester }}</h2>
                    <table class="edit-student-table">
                        <thead>
                            <tr>
                                <th>Subject Name</th>
                                <th>Marks Obtained</th>
                                <th>Max Marks</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subjects-{{ loop.index }}">
                            {% for subj in sem.subjects %}
                            <tr>
                                <td><input type="text" name="semesters[{{ loop.index0 }}][subjects][{{ loop.index0 }}][name]" value="{{ subj.subject }}" {% if not is_admin %}readonly{% endif %} required></td>
                                <td><input type="number" name="semesters[{{ loop.index0 }}][subjects][{{ loop.index0 }}][marks_obtained]" value="{{ subj.marks_obtained }}" {% if not is_admin %}readonly{% endif %} required></td>
                                <td><input type="number" name="semesters[{{ loop.index0 }}][subjects][{{ loop.index0 }}][max_marks]" value="{{ subj.max_marks }}" {% if not is_admin %}readonly{% endif %} required></td>
                                {% if is_admin %}
                                <td><button type="button" onclick="removeSubject(this)">Remove Subject</button></td>
                                {% else %}
                                <td></td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% if is_admin %}
                    <button type="button" class="add-subject-button" data-semester="{{ loop.index }}" onclick="addSubject(this)">Add Subject</button>
                    <button type="button" class="remove-semester-button" onclick="removeSemester(this)">Remove Semester</button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="edit-student-actions">
                {% if is_admin %}
                <button type="button" class="add-semester-button" onclick="addSemester()">Add Semester</button>
                <button type="submit" class="edit-student-action-button">Save Changes</button>
                {% else %}
                <p>You do not have permission to edit this student.</p>
                {% endif %}
                <a href="{{ url_for('index') }}" class="edit-student-action-button">Cancel</a>
            </div>
        </form>
    </div>
</body>
</html>
